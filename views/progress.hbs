<a href="/street">
    <img style="height:30px; float:left; margin-top: 5px; margin-left: 5px;" src="/images/buttons/backButton.png"/>
</a>
<h2 style="z-index: -1; position: absolute; text-align: center; width: 100%;">Progress</h2>

<a id="mail-link" href="#" target="_top" class="btn btn-info" role="button" style="float: right">Send Mail</a>

<!--<a href="/street">Back to street</a>-->
<br/>
<br/>
<ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item">
        <a class="nav-link active" id="recent-quizzes-tab" data-toggle="tab" href="#recent-quizzes" role="tab" aria-controls="recent-quizzes" aria-selected="true">Recent Quizzes</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="all-category-data-tab" data-toggle="tab" href="#all-category-data" role="tab" aria-controls="all-category-data" aria-selected="false">Categories</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="individual-words-tab" data-toggle="tab" href="#individual-words" role="tab" aria-controls="individual-words" aria-selected="false">Individual Words</a>
    </li>
</ul>

<div class="tab-content" id="recentQuizzesTabContent">
    <div class="tab-pane fade show active" id="recent-quizzes" role="tabpanel" aria-labelledby="recent-quizzes-tab">
        <table id="recentQuizzesTable" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
            <tr>
                <th class="th-sm">Category
                </th>
                <th class="th-sm">Subcategory
                </th>
                <th class="th-sm">Correct Words
                </th>
                <th class="th-sm">Incorrect Words
                </th>
                <th class="th-sm">Percent Correct
                </th>
                <th class="th-sm">Date Taken
                </th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

    </div>
    <div class="tab-pane fade" id="all-category-data" role="tabpanel" aria-labelledby="all-category-data-tab">
        <table id="categoriesTable" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
            <tr>
                <th class="th-sm">Category
                </th>
                <th class="th-sm">Subcategory
                </th>
                <th class="th-sm">Total Correct
                </th>
                <th class="th-sm">Total Incorrect
                </th>
                <th class="th-sm">Percent Correct
                </th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <div class="tab-pane fade" id="individual-words" role="tabpanel" aria-labelledby="individual-words-tab">
        <table id="individualWordsTable" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
            <tr>
                <th class="th-sm">Word
                </th>
                <th class="th-sm">Category
                </th>
                <th class="th-sm">Subcategory
                </th>
                <th class="th-sm">Total Correct
                </th>
                <th class="th-sm">Total Incorrect
                </th>
                <th class="th-sm">Percent Correct
                </th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    </div>
</div>

<br/>


<!--<h2 style="z-index: -1; position: absolute; text-align: center; width: 100%;">Progress</h2>-->
<!--<br style="clear: both;"/>-->
<!--<p>stat 1: {{stat1}}</p>-->
<!--<p>stat 2: {{stat2}}</p>-->

<!--<p id="progressData">-->
    <!--empty-->
<!--</p>-->


<script>
    $(document).ready(function () {
        if (sessionStorage.getItem('progress') === null) {
            $('#mail-link').attr('href', "mailto:?&subject=Brainy%20Words%202000%20Stats&body=No%20quizzes%20have%20been%20taken%20yet.");
            return;
        }
        const progress = JSON.parse(sessionStorage.getItem("progress"));
        const quizzes = progress.quizzes;
        const words = progress.words;
        const subcategories = progress.subcategories;

        let quizEmailText = [];

        let elementNumber = 1;
        $.each(quizzes, function( index, quiz ) {
            let subcategory = quiz.subcategory;
            let category = quiz.parentCategory;
            if (category === undefined || category === "") {
                category = subcategory;
                subcategory = "";
            }

            const rightText = quiz.right.join(", ");
            const wrongText = quiz.wrong.join(", ");
            const date = quiz.date;

            const totalQuestions = quiz.right.length + quiz.wrong.length;
            let correctPercent = 0;
            if(totalQuestions > 0) {
                correctPercent = 100 * quiz.right.length / totalQuestions;
            }

            const newRow = "<tr><td>" + category + "</td><td>" + subcategory + "</td><td>" + rightText + "</td><td>"
                    + wrongText + "</td><td>" + correctPercent + "%</td><td>" + date + "</td></tr>";
            $('#recentQuizzesTable tbody').append(newRow);


            quizEmailText.push(elementNumber + ". Category: " + category + ", Subcategory: " + subcategory + ", Correct Words: " + rightText
                + ", Incorrect Words: " + wrongText + ", Percent Correct: " + correctPercent + "%, Date Taken: " + date);

            elementNumber++;
        });

        let categoryEmailText = [];
        elementNumber = 1;

        $.each(subcategories, function( subcategory, data ) {
            let category = data.parentCategory;
            if (category === undefined || category === "") {
                category = subcategory;
                subcategory = "";
            }

            const rightText = data.right;
            const wrongText = data.wrong;

            const totalQuestions = parseInt(rightText) + parseInt(wrongText);
            let correctPercent = 0;
            if(totalQuestions > 0) {
                correctPercent = 100 * parseInt(rightText) / totalQuestions;
            }

            const newRow = "<tr><td>" + category + "</td><td>" + subcategory + "</td><td>" + rightText + "</td><td>"
                    + wrongText + "</td><td>" + correctPercent + "%</td></tr>";
            $('#categoriesTable tbody').append(newRow);

            categoryEmailText.push(elementNumber + ". Category: " + category + ", Subcategory: " + subcategory + ", Correct: " + rightText
                    + ", Incorrect: " + wrongText + ", Percent Correct: " + correctPercent + "%");
            elementNumber++;
        });

        let wordEmailText = [];
        elementNumber = 1;

        $.each(words, function( word, data ) {
            let subcategory = data.subcategory;
            let category = data.parentCategory;
            if (category === undefined || category === "") {
                category = subcategory;
                subcategory = "";
            }

            const rightText = data.right;
            const wrongText = data.wrong;

            const totalQuestions = parseInt(rightText) + parseInt(wrongText);
            let correctPercent = 0;
            if(totalQuestions > 0) {
                correctPercent = 100 * parseInt(rightText) / totalQuestions;
            }

            const newRow = "<tr><td>" + word + "</td><td>" + category + "</td><td>" + subcategory + "</td><td>" + rightText + "</td><td>"
                    + wrongText + "</td><td>" + correctPercent + "%</td></tr>";
            $('#individualWordsTable tbody').append(newRow);

            wordEmailText.push(elementNumber + ". Word: " + word + ", Category: " + category + ", Subcategory: " + subcategory + ", Correct: " + rightText
                    + ", Incorrect: " + wrongText + ", Percent Correct: " + correctPercent + "%");
            elementNumber++;
        });

        const emailTo = "";
        const emailSubj = "Brainy Words 2000 Stats";
        let emailBody = "Quizzes:\n" + quizEmailText.join('\n') + '\n\nCategories:\n' + categoryEmailText.join('\n')
            + '\n\nWords:\n' + wordEmailText.join('\n') + '\n';

        emailBody = encodeURI(emailBody);

        $('#mail-link').attr('href', "mailto:"+emailTo+'?&subject='+emailSubj+'&body='+emailBody);

        $('#recentQuizzesTable').DataTable();
        // $('.dataTables_length').addClass('bs-select');

        $('#categoriesTable').DataTable();

        $('#individualWordsTable').DataTable();
    });
    // document.getElementById("progressData").innerText = sessionStorage.getItem("progress");
</script>